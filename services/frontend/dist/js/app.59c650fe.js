(()=>{"use strict";var t={761:(t,e,a)=>{var s=a(751),r=a(641),i=a(33);const n={key:0,class:"loading"},o={key:1,class:"error"},d={key:2,class:"shared-mode"},h={key:3},l={key:4};function u(t,e,a,s,u,c){const f=(0,r.g2)("UserInfo"),p=(0,r.g2)("BirthdayForm");return(0,r.uX)(),(0,r.CE)("div",{id:"app",style:(0,i.Tr)({backgroundColor:u.backgroundColor})},[u.loading?((0,r.uX)(),(0,r.CE)("div",n," Загрузка... ")):u.error?((0,r.uX)(),(0,r.CE)("div",o,(0,i.v_)(u.error),1)):u.sharedMode?((0,r.uX)(),(0,r.CE)("div",d,[(0,r.bF)(f,{userInfo:u.userInfo,birthday:u.birthday},null,8,["userInfo","birthday"])])):u.birthdaySet?((0,r.uX)(),(0,r.CE)("div",l,[(0,r.bF)(f,{userInfo:u.userInfo,birthday:u.birthday},null,8,["userInfo","birthday"])])):((0,r.uX)(),(0,r.CE)("div",h,[(0,r.bF)(p,{onSubmit:c.setBirthday},null,8,["onSubmit"])]))],4)}const c={class:"birthday-form"},f=["max"],p=["disabled"];function m(t,e,a,i,n,o){return(0,r.uX)(),(0,r.CE)("div",c,[e[2]||(e[2]=(0,r.Lk)("h2",null,"Введите вашу дату рождения",-1)),(0,r.bo)((0,r.Lk)("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=t=>n.birthday=t),class:"date-input",max:n.today},null,8,f),[[s.Jo,n.birthday]]),(0,r.Lk)("button",{onClick:e[1]||(e[1]=(...t)=>o.submitForm&&o.submitForm(...t)),class:"telegram-button",disabled:!n.birthday}," Продолжить ",8,p)])}const y={name:"BirthdayForm",data(){return{birthday:"",today:(new Date).toISOString().split("T")[0]}},computed:{isValidDate(){return this.birthday&&new Date(this.birthday)<new Date}},methods:{submitForm(){this.isValidDate&&this.$emit("submit",this.birthday)}}};var b=a(262);const w=(0,b.A)(y,[["render",m],["__scopeId","data-v-25229c30"]]),g=w,v={class:"user-info"},k={key:0,class:"error-message"},I={class:"info-item"},L={class:"value"},D={key:0,class:"info-item"},_={class:"value"},C={key:1,class:"info-item"},E={class:"value"},S={class:"birthday-countdown"},T={class:"countdown-values"},U={class:"countdown-item"},M={class:"count"},B={class:"countdown-item"},A={class:"count"},F={class:"countdown-item"},O={class:"count"},x={key:2,class:"sending-indicator"};function X(t,e,a,s,n,o){return(0,r.uX)(),(0,r.CE)("div",v,[o.isValidUserInfo||n.sharedData?((0,r.uX)(),(0,r.CE)("div",{key:1,class:(0,i.C4)(["user-details",{"shared-info":n.sharedData}])},[(0,r.Lk)("h2",null,(0,i.v_)(n.sharedData?"Информация от пользователя":"Информация о пользователе"),1),(0,r.Lk)("div",I,[e[0]||(e[0]=(0,r.Lk)("span",{class:"label"},"Имя:",-1)),(0,r.Lk)("span",L,(0,i.v_)(o.displayUserInfo.first_name),1)]),o.displayUserInfo.last_name?((0,r.uX)(),(0,r.CE)("div",D,[e[1]||(e[1]=(0,r.Lk)("span",{class:"label"},"Фамилия:",-1)),(0,r.Lk)("span",_,(0,i.v_)(o.displayUserInfo.last_name),1)])):(0,r.Q3)("",!0),o.displayUserInfo.username?((0,r.uX)(),(0,r.CE)("div",C,[e[2]||(e[2]=(0,r.Lk)("span",{class:"label"},"Username:",-1)),(0,r.Lk)("span",E,"@"+(0,i.v_)(o.displayUserInfo.username),1)])):(0,r.Q3)("",!0),(0,r.Lk)("div",S,[e[6]||(e[6]=(0,r.Lk)("h3",null,"До дня рождения осталось:",-1)),(0,r.Lk)("div",T,[(0,r.Lk)("div",U,[(0,r.Lk)("span",M,(0,i.v_)(n.timeLeft.days),1),e[3]||(e[3]=(0,r.Lk)("span",{class:"unit"},"дней",-1))]),(0,r.Lk)("div",B,[(0,r.Lk)("span",A,(0,i.v_)(n.timeLeft.hours),1),e[4]||(e[4]=(0,r.Lk)("span",{class:"unit"},"часов",-1))]),(0,r.Lk)("div",F,[(0,r.Lk)("span",O,(0,i.v_)(n.timeLeft.minutes),1),e[5]||(e[5]=(0,r.Lk)("span",{class:"unit"},"минут",-1))])])]),n.isSharing?((0,r.uX)(),(0,r.CE)("div",x,[e[7]||(e[7]=(0,r.Lk)("div",{class:"spinner"},null,-1)),(0,r.Lk)("span",null,(0,i.v_)(t.sendingStatus),1)])):(0,r.Q3)("",!0)],2)):((0,r.uX)(),(0,r.CE)("div",k," Ошибка: данные пользователя недоступны "))])}const j={name:"UserInfo",props:{userInfo:{type:Object,required:!0},birthday:{type:String,required:!0}},data(){return{timeLeft:{days:0,hours:0,minutes:0},timer:null,isSharing:!1,sharedData:null}},computed:{isValidUserInfo(){return this.userInfo&&"object"===typeof this.userInfo&&"first_name"in this.userInfo},currentBirthday(){return this.sharedData?this.sharedData.share.birthday:this.birthday},displayUserInfo(){return this.sharedData?this.sharedData.user:this.userInfo}},methods:{calculateTimeLeft(){try{const t=new Date,e=new Date(this.currentBirthday),a=new Date(t.getFullYear(),e.getMonth(),e.getDate());a<t&&a.setFullYear(t.getFullYear()+1);const s=a-t;this.timeLeft={days:Math.floor(s/864e5),hours:Math.floor(s%864e5/36e5),minutes:Math.floor(s%36e5/6e4)}}catch(t){this.timeLeft={days:0,hours:0,minutes:0}}},async loadSharedData(t){try{const e=await fetch(`/api/share/${t}`);if(!e.ok)throw new Error("Не удалось загрузить данные");this.sharedData=await e.json()}catch(e){console.error("Error loading shared data:",e),this.sharedData=null}},async shareInfo(){if(!window.Telegram?.WebApp)return;const t=window.Telegram.WebApp;this.isSharing=!0;try{t.MainButton.showProgress(),t.MainButton.setText("Отправка...");const e=Math.random().toString(36).substring(2,15),a=t.initDataUnsafe?.user?.id;if(!a)throw new Error("Не удалось получить ID пользователя");const s={shareId:e,data:{birthday:this.birthday},chatId:a,userInfo:t.initDataUnsafe.user},r=await fetch("/api/share",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)}).catch((t=>{throw new Error(`Ошибка сети: ${t.message}`)}));if(!r.ok){const t=await r.text();throw new Error(`Ошибка сервера (${r.status}): ${t}`)}t.MainButton.hideProgress(),t.showPopup({title:"Успех",message:"Ссылка отправлена в чат.",buttons:[{type:"close"}]}),setTimeout((()=>{t.close()}),1e3)}catch(e){t.MainButton.hideProgress(),t.MainButton.setText("Поделиться"),t.showPopup({title:"Ошибка",message:e.message||"Не удалось отправить данные",buttons:[{type:"close"}]})}finally{this.isSharing=!1}}},async mounted(){if(this.calculateTimeLeft(),this.timer=setInterval(this.calculateTimeLeft,6e4),!this.sharedData&&window.Telegram?.WebApp){const t=window.Telegram.WebApp;t.MainButton.setText("Поделиться"),t.MainButton.show(),t.MainButton.onClick((()=>this.shareInfo()))}},beforeDestroy(){this.timer&&clearInterval(this.timer),window.Telegram?.WebApp&&window.Telegram.WebApp.MainButton.hide()}},W=(0,b.A)(j,[["render",X],["__scopeId","data-v-20aaa810"]]),P=W,$={name:"App",components:{BirthdayForm:g,UserInfo:P},data(){return{userInfo:{},birthday:"",birthdaySet:!1,loading:!0,error:null,sharedMode:!1,backgroundColor:"#ffffff",isValidWebApp:!1,tg:null}},methods:{setBirthday(t){this.birthday=t,this.birthdaySet=!0},async checkForSharedData(){const t=window.Telegram?.WebApp;let e=null;if(t?.initDataUnsafe?.start_param){const a=t.initDataUnsafe.start_param;a.startsWith("share_")&&(e=a.substring(6))}else{const t=new URLSearchParams(window.location.search);e=t.get("share_id")}if(!e&&window.location.href.includes("startapp=")){const t=window.location.href.match(/startapp=share_([^&]+)/);t&&t[1]&&(e=t[1])}if(e)try{const t=await fetch(`/api/share/${e}`);if(!t.ok)throw new Error("Не удалось загрузить данные");const a=await t.json();this.userInfo=a.user,this.birthday=a.share.birthday,this.birthdaySet=!0,this.sharedMode=!0}catch(a){this.error=`Ошибка: ${a.message}`}}},async mounted(){try{const t=window.Telegram?.WebApp;t&&(this.tg=t,this.isValidWebApp=!0,t.ready(),t.expand(),this.backgroundColor=t.backgroundColor||"#ffffff"),await this.checkForSharedData(),this.sharedMode||(this.userInfo=t?t.initDataUnsafe?.user||{}:{first_name:"Тестовый",last_name:"Пользователь",username:"test_user"}),this.loading=!1}catch(t){this.error=`Ошибка: ${t.message}`,this.loading=!1}}},V=(0,b.A)($,[["render",u]]),Q=V;(0,s.Ef)(Q).mount("#app")}},e={};function a(s){var r=e[s];if(void 0!==r)return r.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,a),i.exports}a.m=t,(()=>{var t=[];a.O=(e,s,r,i)=>{if(!s){var n=1/0;for(l=0;l<t.length;l++){for(var[s,r,i]=t[l],o=!0,d=0;d<s.length;d++)(!1&i||n>=i)&&Object.keys(a.O).every((t=>a.O[t](s[d])))?s.splice(d--,1):(o=!1,i<n&&(n=i));if(o){t.splice(l--,1);var h=r();void 0!==h&&(e=h)}}return e}i=i||0;for(var l=t.length;l>0&&t[l-1][2]>i;l--)t[l]=t[l-1];t[l]=[s,r,i]}})(),(()=>{a.d=(t,e)=>{for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}})(),(()=>{a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{var t={524:0};a.O.j=e=>0===t[e];var e=(e,s)=>{var r,i,[n,o,d]=s,h=0;if(n.some((e=>0!==t[e]))){for(r in o)a.o(o,r)&&(a.m[r]=o[r]);if(d)var l=d(a)}for(e&&e(s);h<n.length;h++)i=n[h],a.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return a.O(l)},s=self["webpackChunkvue_fastapi_example"]=self["webpackChunkvue_fastapi_example"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var s=a.O(void 0,[504],(()=>a(761)));s=a.O(s)})();
//# sourceMappingURL=app.59c650fe.js.map