{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, createVNode as _createVNode, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_2 = {\n  key: 1,\n  class: \"error\"\n};\nconst _hoisted_3 = {\n  key: 2,\n  class: \"shared-mode\"\n};\nconst _hoisted_4 = {\n  key: 3\n};\nconst _hoisted_5 = {\n  key: 4\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_UserInfo = _resolveComponent(\"UserInfo\");\n  const _component_BirthdayForm = _resolveComponent(\"BirthdayForm\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    id: \"app\",\n    style: _normalizeStyle({\n      backgroundColor: $data.backgroundColor\n    })\n  }, [$data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, \" Загрузка... \")) : $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, _toDisplayString($data.error), 1)) : $data.sharedMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createVNode(_component_UserInfo, {\n    userInfo: $data.userInfo,\n    birthday: $data.birthday\n  }, null, 8, [\"userInfo\", \"birthday\"])])) : !$data.birthdaySet ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createVNode(_component_BirthdayForm, {\n    onSubmit: $options.setBirthday\n  }, null, 8, [\"onSubmit\"])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createVNode(_component_UserInfo, {\n    userInfo: $data.userInfo,\n    birthday: $data.birthday\n  }, null, 8, [\"userInfo\", \"birthday\"])]))], 4);\n}","map":{"version":3,"names":["key","class","_createElementBlock","id","style","_normalizeStyle","backgroundColor","$data","loading","_hoisted_1","error","_hoisted_2","_toDisplayString","sharedMode","_hoisted_3","_createVNode","_component_UserInfo","userInfo","birthday","birthdaySet","_hoisted_4","_component_BirthdayForm","onSubmit","$options","setBirthday","_hoisted_5"],"sources":["/Users/wiquzix/Desktop/tzrobita/src/App.vue"],"sourcesContent":["<template>\n  <div id=\"app\" :style=\"{ backgroundColor: backgroundColor }\">\n    <div v-if=\"loading\" class=\"loading\">\n      Загрузка...\n    </div>\n    <div v-else-if=\"error\" class=\"error\">\n      {{ error }}\n    </div>\n    <div v-else-if=\"sharedMode\" class=\"shared-mode\">\n      <UserInfo :userInfo=\"userInfo\" :birthday=\"birthday\" />\n    </div>\n    <div v-else-if=\"!birthdaySet\">\n      <BirthdayForm @submit=\"setBirthday\" />\n    </div>\n    <div v-else>\n      <UserInfo :userInfo=\"userInfo\" :birthday=\"birthday\" />\n    </div>\n  </div>\n</template>\n\n<script>\nimport BirthdayForm from './components/BirthdayForm.vue'\nimport UserInfo from './components/UserInfo.vue'\n\nexport default {\n  name: 'App',\n  components: {\n    BirthdayForm,\n    UserInfo\n  },\n  data() {\n    return {\n      userInfo: {},\n      birthday: '',\n      birthdaySet: false,\n      loading: true,\n      error: null,\n      sharedMode: false,\n      backgroundColor: '#ffffff',\n      isValidWebApp: false,\n      tg: null\n    }\n  },\n  methods: {\n    setBirthday(date) {\n      this.birthday = date;\n      this.birthdaySet = true;\n    },\n    async checkForSharedData() {\n      // Проверяем наличие параметра share_id в URL или в startapp\n      const tg = window.Telegram?.WebApp;\n      let shareId = null;\n      \n      console.log(\"App: Проверка параметров запуска\");\n      \n      if (tg?.initDataUnsafe?.start_param) {\n        const startParam = tg.initDataUnsafe.start_param;\n        console.log(\"App: Получен start_param:\", startParam);\n        \n        if (startParam.startsWith('share_')) {\n          shareId = startParam.substring(6);\n        }\n      } else {\n        const urlParams = new URLSearchParams(window.location.search);\n        shareId = urlParams.get('share_id');\n      }\n      \n      // Дополнительная проверка для startapp в URL\n      if (!shareId && window.location.href.includes('startapp=')) {\n        const match = window.location.href.match(/startapp=share_([^&]+)/);\n        if (match && match[1]) {\n          shareId = match[1];\n        }\n      }\n      \n      if (shareId) {\n        console.log(\"App: Найден shareId:\", shareId);\n        try {\n          const response = await fetch(`/api/share/${shareId}`);\n          if (!response.ok) {\n            throw new Error('Не удалось загрузить данные');\n          }\n          \n          const data = await response.json();\n          console.log(\"App: Загружены данные:\", data);\n          \n          // Устанавливаем данные из шаринга\n          this.userInfo = data.user;\n          this.birthday = data.share.birthday;\n          this.birthdaySet = true;\n          this.sharedMode = true;\n        } catch (error) {\n          console.error(\"App: Ошибка при загрузке данных:\", error);\n          this.error = `Ошибка: ${error.message}`;\n        }\n      } else {\n        console.log(\"App: shareId не найден, показываем стандартный интерфейс\");\n      }\n    }\n  },\n  async mounted() {\n    try {\n      // Инициализация Telegram WebApp\n      const tg = window.Telegram?.WebApp;\n      if (tg) {\n        this.tg = tg;\n        this.isValidWebApp = true;\n        \n        // Инициализация Telegram Web App\n        tg.ready();\n        tg.expand();\n        \n        // Используем цвет темы из Telegram\n        this.backgroundColor = tg.backgroundColor || '#ffffff';\n      }\n      \n      // Проверяем наличие данных из шаринга\n      await this.checkForSharedData();\n      \n      // Если не в режиме шаринга, получаем данные пользователя из Telegram\n      if (!this.sharedMode) {\n        if (tg) {\n          this.userInfo = tg.initDataUnsafe?.user || {};\n        } else {\n          console.warn('Telegram WebApp не доступен');\n          // Для тестирования без Telegram\n          this.userInfo = {\n            first_name: 'Тестовый',\n            last_name: 'Пользователь',\n            username: 'test_user'\n          };\n        }\n      }\n      \n      this.loading = false;\n    } catch (error) {\n      console.error('Ошибка при инициализации:', error);\n      this.error = `Ошибка: ${error.message}`;\n      this.loading = false;\n    }\n  }\n}\n</script>\n\n<style>\n#app {\n  font-family: 'Roboto', sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  color: var(--tg-theme-text-color, #000000);\n  background-color: var(--tg-theme-bg-color, #ffffff);\n  min-height: 100vh;\n  padding: 16px;\n}\n\n.loading, .error {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n  text-align: center;\n  padding: 20px;\n}\n\n.error {\n  color: var(--tg-theme-destructive-text-color, #ff3b30);\n}\n\n.shared-mode {\n  padding: 10px;\n}\n\nh2 {\n  color: var(--tg-theme-text-color, #000000);\n  text-align: center;\n  margin-bottom: 20px;\n}\n</style>\n  \n  "],"mappings":";;EAAAA,GAAA;EAEwBC,KAAK,EAAC;;;EAF9BD,GAAA;EAK2BC,KAAK,EAAC;;;EALjCD,GAAA;EAQgCC,KAAK,EAAC;;;EARtCD,GAAA;AAAA;;EAAAA,GAAA;AAAA;;;;uBACEE,mBAAA,CAgBM;IAhBDC,EAAE,EAAC,KAAK;IAAEC,KAAK,EADtBC,eAAA;MAAAC,eAAA,EAC2CC,KAAA,CAAAD;IAAe;MAC3CC,KAAA,CAAAC,OAAO,I,cAAlBN,mBAAA,CAEM,OAFNO,UAEM,EAF8B,eAEpC,KACgBF,KAAA,CAAAG,KAAK,I,cAArBR,mBAAA,CAEM,OAFNS,UAEM,EAAAC,gBAAA,CADDL,KAAA,CAAAG,KAAK,SAEMH,KAAA,CAAAM,UAAU,I,cAA1BX,mBAAA,CAEM,OAFNY,UAEM,GADJC,YAAA,CAAsDC,mBAAA;IAA3CC,QAAQ,EAAEV,KAAA,CAAAU,QAAQ;IAAGC,QAAQ,EAAEX,KAAA,CAAAW;8CAE3BX,KAAA,CAAAY,WAAW,I,cAA5BjB,mBAAA,CAEM,OAbVkB,UAAA,GAYML,YAAA,CAAsCM,uBAAA;IAAvBC,QAAM,EAAEC,QAAA,CAAAC;EAAW,0B,oBAEpCtB,mBAAA,CAEM,OAhBVuB,UAAA,GAeMV,YAAA,CAAsDC,mBAAA;IAA3CC,QAAQ,EAAEV,KAAA,CAAAU,QAAQ;IAAGC,QAAQ,EAAEX,KAAA,CAAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}