{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, createVNode as _createVNode, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_2 = {\n  key: 1,\n  class: \"error\"\n};\nconst _hoisted_3 = {\n  key: 2,\n  class: \"shared-mode\"\n};\nconst _hoisted_4 = {\n  key: 3\n};\nconst _hoisted_5 = {\n  key: 4\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_UserInfo = _resolveComponent(\"UserInfo\");\n  const _component_BirthdayForm = _resolveComponent(\"BirthdayForm\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    id: \"app\",\n    style: _normalizeStyle({\n      backgroundColor: $data.backgroundColor\n    })\n  }, [$data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, \" Загрузка... \")) : $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, _toDisplayString($data.error), 1)) : $data.sharedMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createVNode(_component_UserInfo, {\n    userInfo: $data.userInfo,\n    birthday: $data.birthday\n  }, null, 8, [\"userInfo\", \"birthday\"])])) : !$data.birthdaySet ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createVNode(_component_BirthdayForm, {\n    onSubmit: $options.setBirthday\n  }, null, 8, [\"onSubmit\"])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createVNode(_component_UserInfo, {\n    userInfo: $data.userInfo,\n    birthday: $data.birthday\n  }, null, 8, [\"userInfo\", \"birthday\"])]))], 4);\n}","map":{"version":3,"names":["key","class","_createElementBlock","id","style","_normalizeStyle","backgroundColor","$data","loading","_hoisted_1","error","_hoisted_2","_toDisplayString","sharedMode","_hoisted_3","_createVNode","_component_UserInfo","userInfo","birthday","birthdaySet","_hoisted_4","_component_BirthdayForm","onSubmit","$options","setBirthday","_hoisted_5"],"sources":["/Users/wiquzix/Desktop/tzrobita/services/frontend/src/App.vue"],"sourcesContent":["<!-- \n  Главный компонент приложения, который управляет состоянием и отображением.\n  Поддерживает два основных режима:\n  1. Ввод даты рождения (BirthdayForm)\n  2. Отображение информации о пользователе (UserInfo)\n  \n  Также поддерживает режим шаринга, когда пользователь открывает приложение по ссылке.\n-->\n<template>\n  <div id=\"app\" :style=\"{ backgroundColor: backgroundColor }\">\n    <!-- Индикатор загрузки -->\n    <div v-if=\"loading\" class=\"loading\">\n      Загрузка...\n    </div>\n    \n    <!-- Сообщение об ошибке -->\n    <div v-else-if=\"error\" class=\"error\">\n      {{ error }}\n    </div>\n    \n    <!-- Режим шаринга - показываем информацию о пользователе, который поделился данными -->\n    <div v-else-if=\"sharedMode\" class=\"shared-mode\">\n      <UserInfo :userInfo=\"userInfo\" :birthday=\"birthday\" />\n    </div>\n    \n    <!-- Режим ввода даты рождения -->\n    <div v-else-if=\"!birthdaySet\">\n      <BirthdayForm @submit=\"setBirthday\" />\n    </div>\n    \n    <!-- Обычный режим - показываем информацию о текущем пользователе -->\n    <div v-else>\n      <UserInfo :userInfo=\"userInfo\" :birthday=\"birthday\" />\n    </div>\n  </div>\n</template>\n\n<script>\nimport BirthdayForm from './components/BirthdayForm.vue'\nimport UserInfo from './components/UserInfo.vue'\n\nexport default {\n  name: 'App',\n  components: {\n    BirthdayForm,\n    UserInfo\n  },\n  data() {\n    return {\n      // Информация о пользователе\n      userInfo: {},\n      // Дата рождения пользователя\n      birthday: '',\n      // Флаг, указывающий, что дата рождения установлена\n      birthdaySet: false,\n      // Флаг загрузки\n      loading: true,\n      // Сообщение об ошибке\n      error: null,\n      // Флаг режима шаринга\n      sharedMode: false,\n      // Цвет фона из Telegram WebApp\n      backgroundColor: '#ffffff',\n      // Флаг доступности Telegram WebApp\n      isValidWebApp: false,\n      // Объект Telegram WebApp\n      tg: null\n    }\n  },\n  methods: {\n    /**\n     * Устанавливает дату рождения пользователя\n     * @param {string} date - Дата рождения в формате YYYY-MM-DD\n     */\n    setBirthday(date) {\n      this.birthday = date;\n      this.birthdaySet = true;\n    },\n    \n    /**\n     * Проверяет наличие параметра share_id в URL или в start_param\n     * Если параметр найден, загружает данные с сервера\n     */\n    async checkForSharedData() {\n      // Проверяем наличие параметра share_id в URL или в startapp\n      const tg = window.Telegram?.WebApp;\n      let shareId = null;\n      \n      // Проверяем start_param из Telegram WebApp\n      if (tg?.initDataUnsafe?.start_param) {\n        const startParam = tg.initDataUnsafe.start_param;\n        \n        if (startParam.startsWith('share_')) {\n          shareId = startParam.substring(6);\n        }\n      } else {\n        // Проверяем URL параметры (для тестирования)\n        const urlParams = new URLSearchParams(window.location.search);\n        shareId = urlParams.get('share_id');\n      }\n      \n      // Дополнительная проверка для startapp в URL\n      if (!shareId && window.location.href.includes('startapp=')) {\n        const match = window.location.href.match(/startapp=share_([^&]+)/);\n        if (match && match[1]) {\n          shareId = match[1];\n        }\n      }\n      \n      // Если найден shareId, загружаем данные\n      if (shareId) {\n        try {\n          const response = await fetch(`/api/share/${shareId}`);\n          if (!response.ok) {\n            throw new Error('Не удалось загрузить данные');\n          }\n          \n          const data = await response.json();\n          \n          // Устанавливаем данные из шаринга\n          this.userInfo = data.user;\n          this.birthday = data.share.birthday;\n          this.birthdaySet = true;\n          this.sharedMode = true;\n        } catch (error) {\n          this.error = `Ошибка: ${error.message}`;\n        }\n      }\n    }\n  },\n  async mounted() {\n    try {\n      // Инициализация Telegram WebApp\n      const tg = window.Telegram?.WebApp;\n      if (tg) {\n        this.tg = tg;\n        this.isValidWebApp = true;\n        \n        // Инициализация Telegram Web App\n        tg.ready();\n        tg.expand();\n        \n        // Используем цвет темы из Telegram\n        this.backgroundColor = tg.backgroundColor || '#ffffff';\n      }\n      \n      // Проверяем наличие данных из шаринга\n      await this.checkForSharedData();\n      \n      // Если не в режиме шаринга, получаем данные пользователя из Telegram\n      if (!this.sharedMode) {\n        if (tg) {\n          this.userInfo = tg.initDataUnsafe?.user || {};\n        } else {\n          // Для тестирования без Telegram\n          this.userInfo = {\n            first_name: 'Тестовый',\n            last_name: 'Пользователь',\n            username: 'test_user'\n          };\n        }\n      }\n      \n      // Завершаем загрузку\n      this.loading = false;\n    } catch (error) {\n      this.error = `Ошибка: ${error.message}`;\n      this.loading = false;\n    }\n  }\n}\n</script>\n\n<style>\n/* Основной контейнер приложения */\n#app {\n  font-family: 'Roboto', sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  color: var(--tg-theme-text-color, #000000);\n  background-color: var(--tg-theme-bg-color, #ffffff);\n  min-height: 100vh;\n  padding: 16px;\n}\n\n/* Индикатор загрузки и сообщение об ошибке */\n.loading, .error {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n  text-align: center;\n  padding: 20px;\n}\n\n/* Сообщение об ошибке */\n.error {\n  color: var(--tg-theme-destructive-text-color, #ff3b30);\n}\n\n/* Контейнер для режима шаринга */\n.shared-mode {\n  padding: 10px;\n}\n\n/* Заголовки */\nh2 {\n  color: var(--tg-theme-text-color, #000000);\n  text-align: center;\n  margin-bottom: 20px;\n}\n</style>\n  \n  "],"mappings":";;EAAAA,GAAA;EAWwBC,KAAK,EAAC;;;EAX9BD,GAAA;EAgB2BC,KAAK,EAAC;;;EAhBjCD,GAAA;EAqBgCC,KAAK,EAAC;;;EArBtCD,GAAA;AAAA;;EAAAA,GAAA;AAAA;;;;uBASEE,mBAAA,CAyBM;IAzBDC,EAAE,EAAC,KAAK;IAAEC,KAAK,EATtBC,eAAA;MAAAC,eAAA,EAS2CC,KAAA,CAAAD;IAAe;MAE3CC,KAAA,CAAAC,OAAO,I,cAAlBN,mBAAA,CAEM,OAFNO,UAEM,EAF8B,eAEpC,KAGgBF,KAAA,CAAAG,KAAK,I,cAArBR,mBAAA,CAEM,OAFNS,UAEM,EAAAC,gBAAA,CADDL,KAAA,CAAAG,KAAK,SAIMH,KAAA,CAAAM,UAAU,I,cAA1BX,mBAAA,CAEM,OAFNY,UAEM,GADJC,YAAA,CAAsDC,mBAAA;IAA3CC,QAAQ,EAAEV,KAAA,CAAAU,QAAQ;IAAGC,QAAQ,EAAEX,KAAA,CAAAW;8CAI3BX,KAAA,CAAAY,WAAW,I,cAA5BjB,mBAAA,CAEM,OA5BVkB,UAAA,GA2BML,YAAA,CAAsCM,uBAAA;IAAvBC,QAAM,EAAEC,QAAA,CAAAC;EAAW,0B,oBAIpCtB,mBAAA,CAEM,OAjCVuB,UAAA,GAgCMV,YAAA,CAAsDC,mBAAA;IAA3CC,QAAQ,EAAEV,KAAA,CAAAU,QAAQ;IAAGC,QAAQ,EAAEX,KAAA,CAAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}